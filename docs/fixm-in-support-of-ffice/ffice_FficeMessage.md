# Encoding guidance for ffice:FficeMessage

![Image](https://www.fixm.aero/releases/FFICE-Msg-1.1.0/doc/logical_model_documentation/EARoot/EA1/EA1/EA4.png)

Go to [XML schema documentation](https://www.fixm.aero/releases/FFICE-Msg-1.1.0/doc/schema_documentation/ffice_message/FficeMessage_FficeMessageType.html)

---

## `filingStatus`

The property `filingStatus` is used in an `FficeMessage` of `type`=`FILING_STATUS` to indicate the status of the submitted flight with respect to the eASP. 
It consists of the following properties:
- as a minimum, property `value` is used to exchange the value of the filing status. It shall be one the following values:
  - `ACCEPTABLE` - Indicates the the eFPL, and in particular the desired route/trajectory, is acceptable.
  - `NOT_ACCEPTABLE` - Indicates that the eFPL, typically the desired route/trajectory, does not comply with operational requirements.
  - `PENDING` - Indicates that the flight plan has not yet been evaluated. This might happen when the eFPL is received by the eASP at a time which is in advance of its processing horizon for the flight, leading to 
     a deferral of the eFPL evaluation.
- property `trajectoryPurpose` can be used to provide the eASP's intended purpose in providing an Agreed R/T in a Filing Status. Property `trajectoryPurpose` may be used only if the Filing Status `value` is `ACCEPTABLE`.
- property `explanation` is used to detail the inconsistencies with the ATM configuration and/or with restrictions that have led to the filing status `value` being set to `NOT_ACCEPTABLE`. Property `explanation` shall be exchanged if and only if the Filing Status `value` is `NOT_ACCEPTABLE`.
- property `expectedEvaluationTime` is used to exchange the time at which the eASP expects to perform its first operational evaluation of the flight plan. Property `expectedEvaluationTime` shall be exchanged if and only if the Filing Status `value` is `PENDING`.
- property `originator` is used to identify the originator of the Filing Status, to be provided when forwarding the Filing Status back to the originator of a forwarding request.

```xml
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:filingStatus>
  <ffice:value>ACCEPTABLE</ffice:value>
</ffice:filingStatus>
```

```xml
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:filingStatus>
  <ffice:expectedEvaluationTime>2024-12-25T00:00:00Z</ffice:expectedEvaluationTime>
  <ffice:value>PENDING</ffice:value>
</ffice:filingStatus>
```

Note: when a Filing Status value is `NOT_ACCEPTABLE`, the content of the property `explanation` may commonly capture 
the errors generated by the flight plan processing system that has evaluated the eFPL. These error messages may vary 
accross systems. Here are local/regional examples of possible content for property `explanation`:
- In Europe, the possible errors and warnings are documented in the EUROCONTROL IPFS Users Manual. Examples:   
   - `PROF323: TRAJECTORY INFO ERROR (MORE THAN ONE TOD)`
   - `PROF323: TRAJECTORY INFO ERROR (LAST ELEMENT DOES NOT CONTAIN THE DESTINATION AERODROME)`
   - `EFPM335: INCONSISTENT DATA (<Aircraft Type> WAS SUBMITTED AS A NON_ICAO AIRCRAFT TYPE DESIGNATOR)`
   - `EFPM324: ACTIVE FPL WITH SAME GUFI EXISTS: (ARCID) (ADEP) (ADES) (EOBT)`
   - `EFPM402: CLOSED FPL WITH SAME GUFI EXISTS: (ARCID) (ADEP) (ADES) (EOBT)`
- Other examples: ...

---

## `flight`

The property `flight` captures the information about the flight associated with the `FficeMessage`. The expected content will vary depending on the `type` of `FficeMessage`.
The information captured in property `flight` shall conform to the general encoding guidance.

## `informationRequest`

The property `informationRequest` is used in an `FficeMessage` of `type`=`FLIGHT_DATA_REQUEST` in order to indicate what information about the flight is being requested. 

The property `informationRequest` provides a choice between:
- a predefined `type` of request, being one of the following values:
    - `FLIGHT_PLAN`, to request the latest submitted flight plan;
    - `FLIGHT_STATUS`, to request the latest status (Planning or Filing) from an eASP;
    - `SUPPLEMENTARY_FLIGHT_PLAN`, to request the latest submitted search and rescue information;
- an `other` custom type of request established by the flight data request service.

```xml
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:informationRequest>
  <ffice:type>FLIGHT_PLAN</ffice:type>
</ffice:informationRequest>
```

```xml
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:informationRequest>
  <ffice:other>PRELIMINARY_FLIGHT_PLAN</ffice:other>
</ffice:informationRequest>
```

---

## `operatorFlightPlanVersion`

The negotiation process introduced by FF-ICE can give rise to a significant number of modifications to the flight plan, performed over a period of time.
In order to assist in data synchronisation and in providing a reference for feedback, the operator is required to provide an 
indication of the flight plan revision, using property `operatorFlightPlanVersion`.

The `operatorFlightPlanVersion` shall be always expressed as a positive integer. An initial eFPL submission shall have the `operatorFlightPlanVersion` set to `1`. 
A subsequent submission intending to replace the previous flight plan should indicate an `operatorFlightPlanVersion` one greater than the previously submitted plan or update.

Examples:

```xml
<!-- Initial submission -->
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:operatorFlightPlanVersion>1</ffice:operatorFlightPlanVersion>
```

```xml
<!-- First subsequent submission -->
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:operatorFlightPlanVersion>2</ffice:operatorFlightPlanVersion>
```

```xml
<!-- Second subsequent submission -->
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:operatorFlightPlanVersion>3</ffice:operatorFlightPlanVersion>
```

*Note: The `operatorFlightPlanVersion` only relates to the provision and update of flight plan data provided by the operator.*

---

## `planningStatus`

The property `planningStatus` is used in an `FficeMessage` of `type`=`PLANNING_STATUS` or `type`=`TRIAL_RESPONSE` to indicate the status of the preliminary flight plan or trial request with respect to the eASP. 
It consists of the following properties:
- as a minimum, property `value` is used to exchange the value of the planning status. It shall be one the following values:
  - `CONCUR` - Indicates that the prelimnary flight plan or trial request, and in particular the route and trajectory, is acceptable without the need for modification. This should mean that if the flight plan were to be filed, it would be accepted.
  - `NON_CONCUR` - Indicates that the preliminary flight plan or trial request does not comply with published airspace/route availability or published restrictions and would result in a rejection or an unacceptable status if the flight plan were to be filed.
  - `NEGOTIATE` - Indicates that the flight plan, and in particular the route and trajectory, is acceptable and would be accepted if filed. However the route/trajectory determined by the eASP has included additional constraints and/or has applied ATM configuration factors such as runway-in-use or Met data which may have resulted in a route/trajectory that is different to the Desired route/trajectory.
- property `explanation` is used to detail the inconsistencies with the ATM configuration and/or with restrictions that have led to the planning status `value` being set to `NON_CONCUR`. Property `explanation` shall be exchanged if and only if the Planning Status `value` is `NON_CONCUR`.

Rules:
- The provision of a `negotiating` route/trajectory group by the eASP is appropriate for a status response of type `NEGOTIATE` or `NON-CONCUR`

---

## `referencedMessageIdentifier`

The property `referencedMessageIdentifier` can be used in an `FficeMessage` of type `SUBMISSION_RESPONSE`, `FILING_STATUS`, 
`PLANNING_STATUS`, `TRIAL_RESPONSE` or `FLIGHT_DATA_RESPONSE` in order to capture the identifier of the `FficeMessage` being 
responded to. It shall be expressed as a valid UUID v4.

```xml
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<!-- RESPONSE TO AN FF-ICE MESSAGE -->
<ffice:FficeMessage [...] >
  <ffice:referencedMessageIdentifier codeSpace="urn:uuid">b4b24bb7-87c7-4ee2-8da9-e78977b1c752</ffice:referencedMessageIdentifier>
  <ffice:type>SUBMISSION_RESPONSE</ffice:type>
  <ffice:uniqueMessageIdentifier codeSpace="urn:uuid">c1e1e0b6-22ae-417b-b125-982fd00c4aae</ffice:uniqueMessageIdentifier>
</ffice:FficeMessage>
```

```xml
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<!-- FFICE MESSAGE BEING RESPONDED TO -->
<ffice:FficeMessage [...] >
  <ffice:type>FILED_FLIGHT_PLAN</ffice:type>
  <ffice:uniqueMessageIdentifier codeSpace="urn:uuid">b4b24bb7-87c7-4ee2-8da9-e78977b1c752</ffice:uniqueMessageIdentifier>
</ffice:FficeMessage>  
```

---

## `respondByLimit`

The property `respondByLimit` can be used in an `FficeMessage` of type `PLANNING_STATUS` or `FILING_STATUS`, as a complement to 
a `negotiating` route/trajectory, in order to capture the time limit by which a response is required. If the appropriate response 
has not been received within the `respondByLimit` provided, the conditions under which the `negotiating` route/trajectory is 
proposed may no longer be available or valid. 

The `respondByLimit` shall be expressed as a valid [DateTimeUtc].

```xml
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:respondByLimit>2024-07-02T17:30:00Z</ffice:respondByLimit>
```

---

## `submissionStatus`

The property `submissionStatus` is used in an `FficeMessage` of `type`=`SUBMISSION_RESPONSE` to indicate whether an `FficeMessage` could be processed and acted on. 
It consists of the following properties:
- as a minimum, property `value` is used to exchange the value of the submission status. It shall be one the following values:
  - `ACK` - Indicates that a message could be processed and acted on.
  - `MAN` - Indicates that a message could not be processed and acted on, and the receiving unit is attempting manual handling of the message.
  - `REJ` - Indicates that a message could not be processed and acted on, and was not retained by the receiving system.
- property `explanation` is used to detail the reasons why the `value` of the submission status has been set to `MAN` or `REJ`. Property `explanation` is mandatory when the submission status `value` is `MAN` or `REJ`.
- property `originator` is used to identify the originator of the Submission Status, to be provided when forwarding the Submission Status back to the originator of a forwarding request.

```xml
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:submissionStatus>
  <ffice:value>ACK</ffice:value>
</ffice:submissionStatus>	
```

---

## `timestamp`

The property `timestamp` is used to exchange the time and date that the `FficeMessage` was sent. It shall be expressed as a valid [DateTimeUtcHighPrecision].

```xml
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:timestamp>2024-06-20T13:54:32.199Z</ffice:timestamp>
```

---

## `type`

The property `type` is used to captured the type of `FficeMessage`. It shall be one of the following values:
  - `FILED_FLIGHT_PLAN`
  - `FILING_STATUS`
  - `FLIGHT_ARRIVAL`
  - `FLIGHT_CANCELLATION`
  - `FLIGHT_DATA_REQUEST`
  - `FLIGHT_DATA_RESPONSE`
  - `FLIGHT_DEPARTURE`
  - `FLIGHT_PLAN_UPDATE`
  - `PLANNING_STATUS`
  - `PRELIMINARY_FLIGHT_PLAN`
  - `SUBMISSION_RESPONSE`
  - `TRIAL_REQUEST`
  - `TRIAL_RESPONSE`

---

## uniqueMessageIdentifier

The property `uniqueMessageIdentifier` can be used to capture the unique identifier of the `FficeMessage`. It shall be expressed as a valid UUID v4.

```xml
<!--xmlns:ffice="http://www.fixm.aero/app/ffice/1.1"-->
<ffice:uniqueMessageIdentifier codeSpace="urn:uuid">ac6d8016-44a6-4038-bf19-e3b7822f302a</ffice:uniqueMessageIdentifier>
```


[DateTimeUtc]: //general-guidance/fb_Types?id=datetimeutc-datetimeutchighprecision
[DateTimeUtcHighPrecision]: //general-guidance/fb_Types?id=datetimeutc-datetimeutchighprecision
